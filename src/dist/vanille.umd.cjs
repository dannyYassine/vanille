(function(c,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(c=typeof globalThis<"u"?globalThis:c||self,a(c.vanille={}))})(this,function(c){"use strict";var J=Object.defineProperty;var U=(c,a,p)=>a in c?J(c,a,{enumerable:!0,configurable:!0,writable:!0,value:p}):c[a]=p;var u=(c,a,p)=>(U(c,typeof a!="symbol"?a+"":a,p),p);const a=s=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Array.from({length:s},()=>e.charAt(Math.floor(Math.random()*e.length))).join("")};class p{constructor(e){u(this,"value");u(this,"subscribers");this.value=e,this.subscribers=new Set}get(){return globalThis.trackDependency&&globalThis.trackDependency(this),this.value}set(e){if(typeof e=="function"&&(e=e(this.value)),this.value!==e){const t=this.value;this.value=e,this.notifySubscribers(this.value,t)}}mutSet(e){const t=this.value;typeof e=="function"&&e(this.value),this.notifySubscribers(this.value,t)}subscribe(e){const t=()=>{this.unsubscribe(e)};return this.subscribers.add(e),t}unsubscribe(e){this.subscribers.delete(e)}notifySubscribers(e,t){this.subscribers.forEach(n=>n(this.value,t))}}class $ extends p{constructor(t){super();u(this,"computeFn");u(this,"dependencies");u(this,"update",()=>{this.compute()});this.computeFn=t,this.value=void 0,this.subscribers=new Set,this.dependencies=new Set,this.compute(!0)}get(){return globalThis.trackDependency&&globalThis.trackDependency(this),this.value}compute(t){if(t){const i=r=>{this.dependencies.add(r),r.subscribe(this.update)};globalThis.trackDependency=i}const n=this.computeFn();if(delete globalThis.trackDependency,n!==this.value){const i=this.value;this.value=n,this.notifySubscribers(this.value,i)}}subscribe(t){const n=()=>{this.unsubscribe(t)};return this.subscribers.add(t),n}unsubscribe(t){this.subscribers.delete(t)}notifySubscribers(t,n){this.subscribers.forEach(i=>i(this.value,n))}}function L(s){const e=[];return globalThis.trackDependency=n=>{n.subscribe(s),e.push(n)},s(),delete globalThis.trackDependency,()=>{e.forEach(n=>{n.unsubscribe(s)})}}const R=s=>new p(s),w=s=>new $(s);class B{constructor(){u(this,"styles","")}setStyles(e){this.styles=e}getStyles(){return this.styles}}const g=new B;var y=(s=>(s.OPEN="open",s.CLOSED="closed",s[s.NONE=void 0]="NONE",s))(y||{});class f extends HTMLElement{constructor(t=y.OPEN){super();u(this,"props");u(this,"styleTag");u(this,"refs");u(this,"$c");u(this,"$scopedId");this.$c=[],t&&this.attachShadow({mode:t}),this.refs=new Proxy({},{get:(n,i)=>this.root.querySelector(`[${this.$scopedId}][ref=${i}]`)})}get root(){return this.shadowRoot?this.shadowRoot:this}styles(){return""}def(){const t=(i,r)=>{const o=this[r];return typeof o=="function"?i[r]=o.bind(this):i[r]=o,i},n=Object.getOwnPropertyNames(this).reduce(t,{});return Object.getOwnPropertyNames(this.__proto__).reduce(t,n)}connectedCallback(){this.updateRender(),this.connected()}disconnectedCallback(){this.disconnected()}adoptedCallback(){this.adopted()}attributeChangedCallback(t,n,i){this.attributeChanged(t,n,i)}connected(){}disconnected(){}adopted(){}attributeChanged(t,n,i){}createStyleTag(){`${this.styles()} ${g.getStyles()}`&&(this.styleTag=document.createElement("style"),L(()=>{this.updateStyles()}),this.root.appendChild(this.styleTag))}updateStyles(){const n=`${this.styles()} ${g.getStyles()}`.trim().replaceAll(/(\S+)(h*.*\{)/gm,`$1[${this.$scopedId}]$2 `);this.styleTag.textContent=n}updateRender(){var n;this.root.innerHTML="";const t=(n=this.render)==null?void 0:n.call(this,this.props);if(t){this.createStyleTag(),this.$scopedId||(this.$scopedId=`v${a(8)}`,this.setAttribute(this.$scopedId,"")),t.$scopedId=this.$scopedId;const i=m(t);this.root.appendChild(i)}}emit(t,n){setTimeout(()=>{let i={bubbles:!0};n&&(i={...i},typeof n=="object"?i.detail={...n}:i.detail=n),this.dispatchEvent(new CustomEvent(t,i))},0)}}customElements.define("v-view",f);class K{buildElement(e){if(e==null?void 0:e.name){if(e instanceof Function&&e.__proto__.name!=="")return this.getElement(e);if(e instanceof Function&&e.__proto__.name===""){const n=new f;return n.render=e.bind(n),n}return this.createElement(e)}return this.createElement(e)}getElement(e){let t=window.customElements.get(`v-${e.name.toLowerCase()}`);return t||(window.customElements.define(`v-${e.name.toLowerCase()}`,e),t=window.customElements.get(`v-${e.name.toLowerCase()}`)),new t}createElement(e){return window.document.createElement(e)}}function C(...s){return[...s]}window.h=C;function m(s,e=new K){const[t,n,...i]=s,r=s.$scopedId??`v${a(8)}`,o=e.buildElement(t);return P(o,r),n&&O(o,n),i.length&&i.filter(Boolean).forEach(d=>S(o,d,e)),o}function P(s,e){s.props={},s.$scopedId=e,s.setAttribute(e,"")}function O(s,e){Object.entries(e).forEach(([t,n])=>{if(_(t,n)){M(s,t,n);return}s.props[t]=n,k(s,t,n)})}function _(s,e){return s.startsWith("on")&&e instanceof Function}function M(s,e,t){e in s?s[e.toLowerCase()]=t:s.addEventListener(e,t)}function k(s,e,t){typeof t=="function"?D(s,e,t):t instanceof p?j(s,e,t):b(s,e,t)}function D(s,e,t){const n=w(t.bind(s));s.$c||(s.$c=[]),s.$c.push(n),n.subscribe(i=>{s[e]=i,b(s,e,i)}),b(s,e,n.get())}function j(s,e,t){t.subscribe(n=>{s.props[e]=n,s[e]=n,b(s,e,n)}),b(s,e,t.get())}function b(s,e,t){try{s.setAttribute(e,t)}catch{}}function S(s,e,t){if(N(e)){e.forEach(n=>S(s,n,t));return}if(F(e)){s.append(e);return}if(e instanceof p){V(s,e);return}if(typeof e=="function"){W(s,e);return}if(H(e)){e.$scopedId=s.$scopedId,s.append(e);return}e.$scopedId=s.$scopedId,s.appendChild(m(e,t))}function N(s){return Array.isArray(s)&&(typeof s[0]=="string"&&typeof s[1]!="object"||Array.isArray(s[0]))}function F(s){return["string","number"].includes(typeof s)}function H(s){return"nodeName"in s||s instanceof HTMLElement}function V(s,e){const t=a(8);s.insertAdjacentHTML("beforeend",`<!--${t}-->${e.get()}<!--${t}-->`),e.subscribe(n=>{T(s,t,n)})}function W(s,e){const t=a(8),n=w(e);s.$c||(s.$c=[]),s.$c.push(n),s.insertAdjacentHTML("beforeend",`<!--${t}-->${n.get()}<!--${t}-->`),n.subscribe(i=>{T(s,t,i)})}function T(s,e,t){const n=new Range,[i,r]=x(s,e);i&&r&&(n.setStartAfter(i),n.setEndBefore(r),n.deleteContents(),n.insertNode(document.createTextNode(t)))}function x(s,e){const t=Array.from(s.childNodes).filter(n=>n.nodeType===8&&n.textContent===e);return[t[0],t[1]]}history.pushState=(s=>function(){var t=s.apply(this,arguments);return window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("locationchange")),t})(history.pushState),history.replaceState=(s=>function(){var t=s.apply(this,arguments);return window.dispatchEvent(new Event("replacestate")),window.dispatchEvent(new Event("locationchange")),t})(history.replaceState),window.addEventListener("popstate",()=>{window.dispatchEvent(new Event("locationchange"))}),window.$location=window.location;class I extends f{constructor(){super();u(this,"matchesRoute",!1);u(this,"location");this.location=window.$location}connected(){window.addEventListener("locationchange",()=>{this.checkPath()}),this.checkPath()}checkPath(){this.location.pathname===this.props.path||this.matchesPattern()?this.matchesRoute||(this.matchesRoute=!0,this.updateRender()):this.matchesRoute&&(this.matchesRoute=!1,this.shadowRoot.innerHTML="")}matchesPattern(){if(!this.props.startWith&&!this.props.path)return!1;const t=this.location.pathname.split("/").filter(o=>o!=="");let n=this.props.startWith?this.props.startWith.split("/"):this.props.path.split("/");if(n=n.filter(o=>o!==""),this.props.path&&t.length!==n.length)return!1;if(this.props.path)return n.filter((o,d)=>o.startsWith(":")?!0:o===t[d]).length===t.length;const i=n.filter(o=>(o.startsWith(":"),!0));let r=0;for(;r<i.length;){if(i[r].startsWith(":")){r++;continue}if(i[r]!==t[r])return!1;r++}return!0}render(){return this.matchesRoute?["slot",{ref:"slot"}]:""}}customElements.define("v-route",I);class E extends f{attributeChanged(){this.updateRender()}render(){return this.getAttribute("value")&&["true",!0,1].includes(this.getAttribute("value"))?h("slot",null):""}}u(E,"observedAttributes",["value"]),customElements.define("v-if",E);class A extends f{constructor(){super(y.CLOSED);u(this,"markersByKey",new Map);u(this,"itemsByKey",new Map)}connectedCallback(){var n;if(!((n=this.props)!=null&&n.items))return;const{items:t}=this.props;t.subscribe((i,r)=>{this.updateList(i,r)}),this.updateList(t.get(),[])}getItemKey(t,n){var i;return`item-${(i=this.props)!=null&&i.key?t[this.props.key]:n}`}shouldUpdateItem(t,n){return typeof t!="object"||t===null?t!==n:JSON.stringify(t)!==JSON.stringify(n)}updateList(t,n){const i=new Map,r=new Set;t.forEach((o,d)=>{const l=this.getItemKey(o,d);if(i.set(l,o),r.add(l),!this.markersByKey.has(l))this.createNewItem(o,l,d);else{const v=this.itemsByKey.get(l);this.shouldUpdateItem(o,v)&&this.updateExistingItem(o,l,d)}});for(const[o,d]of this.markersByKey.entries())r.has(o)||this.removeItem(o);this.itemsByKey=i}createNewItem(t,n,i){const r=document.createComment(`for-${n}`),o=document.createComment(`/for-${n}`);if(this.markersByKey.set(n,[r,o]),this.root.appendChild(r),this.props.template){const d=this.props.template(t,i),l=m(d);this.root.appendChild(l)}else this.root.appendChild(document.createTextNode(String(t)));this.root.appendChild(o)}updateExistingItem(t,n,i){const[r,o]=this.markersByKey.get(n),d=new Range;if(d.setStartAfter(r),d.setEndBefore(o),d.deleteContents(),this.props.template){const l=this.props.template(t,i),v=m(l);d.insertNode(v)}else d.insertNode(document.createTextNode(String(t)))}removeItem(t){const[n,i]=this.markersByKey.get(t),r=new Range;r.setStartBefore(n),r.setEndAfter(i),r.deleteContents(),this.markersByKey.delete(t),this.itemsByKey.delete(t)}}customElements.define("v-for",A),c.For=A,c.If=E,c.Route=I,c.View=f,c.ViewMode=y,c.computed=w,c.default=g,c.h=C,c.render=m,c.state=R,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
